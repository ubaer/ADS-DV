<head>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://unpkg.com/event-drops"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.2/moment.js"></script>

    <link rel="stylesheet" type="text/css" href="stylesheet.css">

</head>

<div style="text-align: center" id="legend"></div>

<div id="chart_placeholder"></div>
<script>
    /*
    var data = [
        {
            name: "Robbery",
            data: [{date: new Date('2014/09/15 13:24:57')}, {date: new Date('2014/09/15 13:27:04')}, {date: new Date('2014/09/15 13:30:04')}],
            color: "black"
        },
        {
            name: "Assault",
            data: [{date: new Date('2014/09/15 13:24:54')}, {date: new Date('2014/09/15 13:33:03')}, {date: new Date('2014/09/15 13:45:05')}],
            color: "crimson"
        },

        {
            name: "Larceny",
            data: [{date: new Date('2014/09/15 13:20:57')}, {date: new Date('2014/09/15 13:22:57')}],
            color: "purple"
        },
        {
            name: "Shooting",
            data: [{date: new Date('2014/09/15 13:50:57'), name: 'ajshdf'}, {date: new Date('2014/09/15 13:59:57'), name:'woeoeo'}],
            color: "red"
        }
    ];
*/

    /* ditc = {
        'Robbery': {
        data: []
        }
       }

*/
    //    var parse = d3.time.format("%mm/%dd/%YYYY").parse;

    var colors = {
        'AUTO THEFT': '#4853e5',
        'SHOOTING': '#b50f0b',
        'AGG. ASSAULT': '#e59ca3',
        'COMMON ASSAULT': '#e8cdce',
        'BURGLARY': '#5d6b6d',
        'HOMICIDE': '#ff191e',
        'ROBBERY - STREET': '#afe570',
        'LARCENY': '#a86b23',
        'RAPE': '#e500c0',
    };

    var unwanted = [
        'ROBBERY - RESIDENCE',
        'ARSON',
        'ROBBERY - COMMERCIAL',
        'ROBBERY - CARJACKING',
        'ASSAULT BY THREAT',
        'LARCENY FROM AUTO'
    ];

    var data;
    d3.csv("2017.csv", function (prices) {
        var dict = {};
        data = prices.map(function (d) {
            return {
                date: moment(d.date + " " + d.CrimeTime, 'MM/DD/YYYY HH:mm:ss').toDate(),
                crimeTime: d.CrimeTime,
                crimeCode: d.CrimeCode,
                location: d.Location,
                description: d.Description
            };
        });

        data.forEach(function (record) {
            if(unwanted.includes(record.description)) {
                return;
            }
            if (!dict.hasOwnProperty(record.description)) {
                dict[record.description] = {
                    data: []
                };
            }
            dict[record.description].data.push(record);
        });


        var newDict = Object.entries(dict).map(function (entry) {
            return {
                name: entry[0],
                data: entry[1].data,
                color: colors[entry[0]]
            };
        });


        var eventDropsChart = d3.chart.eventDrops();

        function listener(d) {
            console.log(d)
        }

        eventDropsChart.start(new Date('2017/04/15 10:24:54'))
            .end(new Date('2017/04/15 13:45:05'))
            .click((d) => listener(d))
            .minScale(0.05)
            .maxScale(1000)
            .eventLineColor(function (e) {
                return e.color;
            });

        d3.select('#chart_placeholder')
            .datum(newDict)
            .call(eventDropsChart);
    })
</script>